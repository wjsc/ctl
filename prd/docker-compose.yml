version: '3'
services:
  traefik:
    container_name: "traefik"
    image: traefik:1.5.2-alpine
    ports:
      - "80:80"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /home/elballetdelosimbeciles/ctl/prd/traefik.toml:/traefik.toml:ro
  front_prd:
    container_name: "front_prd"
    environment:
      TZ: "America/Argentina/Buenos_Aires"
      NODE_ENV: "production"
      NPM_CONFIG_PREFIX: "/home/node/.npm-global"
    build: ./front
    ports:
      - "3000:3000"
    labels:
      traefik.backend: "front"
      traefik.frontend.rule: "Host:catalogue.cf"
      traefik.enable: "true"
      traefik.port: "3000"
  api_prd:
    container_name: "api_prd"
    environment:
      TZ: "America/Argentina/Buenos_Aires"
      NODE_ENV: "production"
      DB_HOST: "db_prd"
      ORIGIN: "*"
    build: ./api
    ports:
      - "3001:3001"
    labels:
      traefik.backend: "api"
      traefik.frontend.rule: "Host:api.catalogue.cf,www.api.catalogue.cf"
      traefik.enable: "true"
      traefik.port: "3001"
  db_prd:
    container_name: "db_prd"
    image: mongo:3.4.0
    environment:
      - MONGO_DATA_DIR=/data/db
      - MONGO_LOG_DIR=/dev/null
    ports:
        - 27017:27017
    command: mongod --smallfiles --logpath=/dev/null 
  static_prd:
    container_name: "static_prd"
    environment:
      TZ: "America/Argentina/Buenos_Aires"
      NODE_ENV: "production"
    build: ./static
    ports:
      - "3002:3002"
    volumes:
      - /home/elballetdelosimbeciles/.catalogue/files/:/app/data:ro
    labels:
      traefik.backend: "static"
      traefik.frontend.rule: "Host:static.catalogue.cf"
      traefik.enable: "true"
      traefik.port: "3002"
networks:
  default:
